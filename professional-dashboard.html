<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professional Dashboard – Sirius Jobs</title>
  <meta name="description" content="Monitor consultations, ratings, payouts and earnings as a Sirius Jobs professional." />
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0056b3',
            secondary: '#0f172a'
          }
        }
      }
    }
  </script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .glass-card { background: rgba(255,255,255,0.9); backdrop-filter: blur(16px); border: 1px solid rgba(148,163,184,0.18); }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- NAV -->
  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <img src="logo.png" alt="Sirius Jobs Logo" class="w-10 h-10 rounded-full object-cover" onerror="this.src='https://via.placeholder.com/80x80?text=SJ'" />
        <span class="text-xl font-bold text-primary">Sirius Jobs</span>
      </div>
      <div class="hidden md:flex space-x-8 items-center text-sm font-medium">
        <a href="index.html" class="text-gray-600 hover:text-primary transition">Home</a>
        <a href="consultations.html" class="text-gray-600 hover:text-primary transition">Consultations</a>
        <a href="jobs.html" class="text-gray-600 hover:text-primary transition">Jobs</a>
        <a href="services.html" class="text-gray-600 hover:text-primary transition">Services</a>
        <a href="verify.html" class="text-gray-600 hover:text-primary transition">Verify</a>
        <button id="professionalLogout" class="text-gray-600 hover:text-primary transition">Logout</button>
      </div>
      <div class="md:hidden">
        <button id="menu-btn" class="text-gray-600 focus:outline-none"><i data-feather="menu"></i></button>
      </div>
    </div>
    <div id="mobile-menu" class="hidden md:hidden bg-white px-4 pb-4 space-y-2 text-sm font-medium">
      <a href="index.html" class="block py-2 text-gray-600 hover:text-primary">Home</a>
      <a href="consultations.html" class="block py-2 text-gray-600 hover:text-primary">Consultations</a>
      <a href="jobs.html" class="block py-2 text-gray-600 hover:text-primary">Jobs</a>
      <a href="services.html" class="block py-2 text-gray-600 hover:text-primary">Services</a>
      <a href="verify.html" class="block py-2 text-gray-600 hover:text-primary">Verify</a>
      <button id="professionalLogoutMobile" class="w-full text-left py-2 text-gray-600 hover:text-primary">Logout</button>
    </div>
  </nav>

  <!-- HERO -->
  <header class="text-white py-16 relative overflow-hidden" style="background-color:#0056b3;">
    <span class="absolute inset-y-0 right-0 w-1/3 bg-white/5 pointer-events-none"></span>
    <div class="container mx-auto px-4 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8">
      <div class="max-w-2xl">
        <p class="text-xs uppercase tracking-[0.4em] text-white/70 mb-4">Professional Dashboard</p>
        <h1 class="text-3xl md:text-4xl font-bold leading-tight">Deliver outstanding care and track every naira you earn.</h1>
        <p class="mt-4 text-white/80">View scheduled sessions, manage payouts, and monitor your ratings the moment clients leave a review.</p>
      </div>
      <div class="glass-card rounded-2xl shadow-xl p-6 text-gray-900 w-full max-w-sm">
        <p class="text-sm text-gray-500">Available to withdraw</p>
        <p id="walletAvailable" class="text-3xl font-semibold text-primary mb-2">₦0</p>
        <div class="flex items-center justify-between text-sm text-gray-600">
          <span>Pending earnings</span>
          <span id="walletPending" class="font-medium text-gray-900">₦0</span>
        </div>
        <div class="flex items-center justify-between text-sm text-gray-600 mt-1">
          <span>Total consultations</span>
          <span id="statConsultations" class="font-medium text-gray-900">0</span>
        </div>
        <div class="mt-6 flex gap-3">
          <button id="requestPayoutBtn" class="flex-1 bg-primary text-white py-2.5 rounded-lg font-medium hover:bg-primary/90 transition">Request payout</button>
          <button id="viewWalletBtn" class="flex-1 border border-primary/40 text-primary font-medium py-2.5 rounded-lg hover:bg-primary hover:text-white transition">Wallet history</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-12 space-y-12">
    <!-- PROFILE SUMMARY -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200/60 p-6 md:p-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div class="flex items-start gap-5">
          <div class="relative">
            <img id="proAvatar" src="https://via.placeholder.com/160x160?text=You" alt="Professional" class="w-32 h-32 md:w-40 md:h-40 rounded-2xl object-cover border-4 border-primary/15 shadow-sm" />
            <button id="editPhotoBtn" class="absolute -bottom-1 -right-1 bg-primary text-white p-2.5 rounded-full shadow-lg hover:bg-primary/90 ring-4 ring-white" type="button"><i data-feather="camera" class="w-4 h-4"></i></button>
            <input type="file" id="profileImageInput" class="hidden" accept="image/*" />
          </div>
          <div class="space-y-3">
            <div class="flex flex-col sm:flex-row sm:items-center sm:gap-3">
              <h2 id="proName" class="text-2xl md:text-3xl font-semibold text-gray-900 leading-tight">Professional Name</h2>
              <span id="proStatusBadge" class="inline-flex items-center gap-1 text-xs font-semibold uppercase tracking-wide px-3 py-1 rounded-full bg-amber-100 text-amber-700 mt-2 sm:mt-0">
                <i data-feather="shield" class="w-3 h-3"></i>
                Pending review
              </span>
            </div>
            <p id="proProfession" class="text-sm text-gray-500">Profession • Regulatory Body</p>
            <div class="flex flex-wrap items-center gap-3 text-sm">
              <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/10 text-primary">
                <i data-feather="star" class="w-4 h-4"></i>
                <span id="statAverageRating">0.0</span>
              </span>
              <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-gray-100 text-gray-600">
                <i data-feather="message-square" class="w-4 h-4"></i>
                <span id="statReviewCount">0 reviews</span>
              </span>
              <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-gray-100 text-gray-600">
                <i data-feather="users" class="w-4 h-4"></i>
                <span id="statClients">0 clients</span>
              </span>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full md:w-auto">
          <article class="sm:col-span-2 bg-primary rounded-2xl text-white p-5 shadow-lg relative overflow-hidden">
            <div class="absolute -right-10 -top-10 w-28 h-28 bg-white/10 rounded-full"></div>
            <div class="absolute -left-8 bottom-0 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="flex items-center gap-3 relative">
              <div class="bg-white/20 p-3 rounded-xl">
                <i data-feather="credit-card" class="w-6 h-6"></i>
              </div>
              <div>
                <p class="text-xs uppercase tracking-wider text-white/70">Net earnings</p>
                <p id="statNetEarnings" class="text-2xl font-semibold mt-1">₦0</p>
              </div>
            </div>
            <p class="text-xs text-white/70 mt-4">Total cleared funds you can withdraw at any time.</p>
          </article>
          <article class="glass-card rounded-2xl p-5 border border-gray-200/70">
            <div class="flex items-center gap-3">
              <div class="bg-primary/10 text-primary p-3 rounded-xl">
                <i data-feather="clock" class="w-5 h-5"></i>
              </div>
              <div>
                <p class="text-xs uppercase tracking-wider text-gray-500">Pending earnings</p>
                <p id="statPendingEarnings" class="text-xl font-semibold text-primary mt-1">₦0</p>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-4">Awaiting client confirmation before release to your wallet.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- SCHEDULE & PAYOUT -->
    <section class="grid grid-cols-1 xl:grid-cols-3 gap-6">
      <aside class="xl:col-span-3 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200/60 p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Wallet history</h3>
          <div id="walletHistory" class="space-y-3"></div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200/60 p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">Payout account</h3>
          <p class="text-sm text-gray-500 mb-4">Add a Nigerian bank account to receive earnings anytime.</p>
          <form id="payoutForm" class="space-y-3">
            <div>
              <label for="bankName" class="block text-xs font-medium text-gray-600 uppercase tracking-wide mb-1">Bank name</label>
              <input id="bankName" name="bankName" type="text" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-primary focus:ring-primary/20" placeholder="e.g. GTBank" required>
            </div>
            <div>
              <label for="accountNumber" class="block text-xs font-medium text-gray-600 uppercase tracking-wide mb-1">Account number</label>
              <input id="accountNumber" name="accountNumber" type="text" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-primary focus:ring-primary/20" placeholder="10-digit number" required>
            </div>
            <div>
              <label for="accountHolder" class="block text-xs font-medium text-gray-600 uppercase tracking-wide mb-1">Account holder</label>
              <input id="accountHolder" name="accountHolder" type="text" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-primary focus:ring-primary/20" placeholder="Name on account" required>
            </div>
            <button type="submit" class="w-full bg-primary text-white py-2.5 rounded-lg font-medium hover:bg-primary/90 transition">Save payout account</button>
          </form>
          <p id="payoutFormStatus" class="text-xs text-gray-500 mt-3"></p>
        </div>
      </aside>
    </section>

    <!-- REVIEWS -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200/60 p-6 md:p-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
        <div>
          <h3 class="text-lg font-semibold text-gray-800">Latest reviews</h3>
          <p class="text-sm text-gray-500">Clients can review each consultation. Share these ratings with prospective employers.</p>
        </div>
        <button id="refreshReviewsBtn" class="text-sm text-primary font-medium hover:underline">Refresh reviews</button>
      </div>
      <div id="reviewList" class="space-y-4"></div>
      <p id="noReviewsState" class="text-sm text-gray-500 hidden">No reviews yet. Encourage clients to leave feedback after each consultation.</p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
              <i data-feather="star" class="text-white w-4 h-4"></i>
            </div>
            <span class="text-lg font-bold">Sirius Jobs</span>
          </div>
          <p class="text-gray-400 mb-4">Connecting talent, trusted professionals and fast support across Nigeria.</p>
          <div class="flex space-x-4">
            <a href="https://web.facebook.com/profile.php?id=61582342397507" class="text-gray-400 hover:text-white transition-all"><i data-feather="facebook"></i></a>
            <a href="https://twitter.com/SiriusOddJobs" class="text-gray-400 hover:text-white transition-all"><i data-feather="twitter"></i></a>
            <a href="https://www.instagram.com/siriusjobss" class="text-gray-400 hover:text-white transition-all"><i data-feather="instagram"></i></a>
            <a href="https://www.linkedin.com/company/siriusjobsng/" class="text-gray-400 hover:text-white transition-all"><i data-feather="linkedin"></i></a>
          </div>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="index.html" class="hover:text-white transition-all">Home</a></li>
            <li><a href="jobs.html" class="hover:text-white transition-all">Jobs</a></li>
            <li><a href="services.html" class="hover:text-white transition-all">Services</a></li>
            <li><a href="consultations.html" class="hover:text-white transition-all">Consultations</a></li>
            <li><a href="findworker.html" class="hover:text-white transition-all">Find Workers</a></li>
            <li><a href="contact.html" class="hover:text-white transition-all">Contact</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Support</h4>
          <ul class="space-y-2 text-gray-400">
            <li><span>Email: support@siriusjobsng.com</span></li>
            <li><span>WhatsApp: 0704 447 0559</span></li>
            <li><span>Hours: 8am – 8pm (Mon-Sat)</span></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Head Office</h4>
          <ul class="space-y-2 text-gray-400">
            <li>Port Harcourt, Rivers State</li>
            <li>Nigeria</li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-400 mb-4 md:mb-0">© 2022 Sirius Jobs. All rights reserved.</p>
        <div class="flex space-x-6">
          <a href="privacypolicy.html" class="text-gray-400 hover:text-white text-sm">Privacy Policy</a>
          <a href="terms.html" class="text-gray-400 hover:text-white text-sm">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    feather.replace();
    const mobileMenuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

    function handleLogout(){
      sessionStorage.clear();
      alert('You have been logged out.');
      window.location.href = 'login.html';
    }
    document.getElementById('professionalLogout').addEventListener('click', handleLogout);
    document.getElementById('professionalLogoutMobile').addEventListener('click', handleLogout);

    const avatarImg = document.getElementById('proAvatar');
    const photoInput = document.getElementById('profileImageInput');
    document.getElementById('editPhotoBtn').addEventListener('click', () => photoInput.click());
    photoInput.addEventListener('change', event => {
      const file = event.target.files?.[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        avatarImg.src = reader.result;
        alert('Profile image updated locally. Save to server when API is ready.');
      };
      reader.readAsDataURL(file);
    });

    const formatCurrency = amount => {
      const value = typeof amount === 'number' ? amount / 100 : 0;
      return new Intl.NumberFormat('en-NG', { style: 'currency', currency: 'NGN', maximumFractionDigits: 0 }).format(value);
    };

    const walletHistoryEl = document.getElementById('walletHistory');
    const reviewList = document.getElementById('reviewList');
    const noReviewsState = document.getElementById('noReviewsState');
    const payoutForm = document.getElementById('payoutForm');
    const payoutFormStatus = document.getElementById('payoutFormStatus');
    const syncCalendarBtn = document.getElementById('syncCalendarBtn');

    async function loadProfessionalData(){
      try {
        const res = await fetch('/api/dashboard/professional');
        if (!res.ok) throw new Error('Unable to fetch professional dashboard');
        const data = await res.json();
        hydrateDashboard(data);
      } catch (error) {
        console.warn(error);
        hydrateDashboard(getFallbackProfessional());
      }
    }

    function hydrateDashboard(data){
      const { profile, wallet, stats, reviews } = data;
     const name = `${profile?.user?.firstName ?? 'Professional'} ${profile?.user?.lastName ?? ''}`.trim();
     document.getElementById('proName').textContent = name || 'Professional Name';
     document.getElementById('proProfession').textContent = `${profile?.profession ?? 'Specialist'}${profile?.regulatoryBody ? ' • ' + profile.regulatoryBody : ''}`;
     if (profile?.profileImageUrl) {
       avatarImg.src = profile.profileImageUrl;
     }

      const statusBadge = document.getElementById('proStatusBadge');
      if (statusBadge) {
        const baseClasses = 'inline-flex items-center gap-1 text-xs font-semibold uppercase tracking-wide px-3 py-1 rounded-full mt-2 sm:mt-0';
        if (profile?.verifiedBadge || profile?.licenseVerified) {
          statusBadge.innerHTML = '<i data-feather="shield" class="w-3 h-3"></i> Verified';
          statusBadge.className = `${baseClasses} bg-emerald-100 text-emerald-700`;
        } else {
          statusBadge.innerHTML = '<i data-feather="shield" class="w-3 h-3"></i> Pending review';
          statusBadge.className = `${baseClasses} bg-amber-100 text-amber-700`;
        }
      }

      const averageRating = stats?.averageRating ? Number(stats.averageRating).toFixed(1) : '0.0';
      const reviewCount = stats?.reviewCount ?? 0;
      const clientsServed = stats?.clientsServed ?? 0;
      document.getElementById('statAverageRating').textContent = averageRating;
      document.getElementById('statReviewCount').textContent = `${reviewCount} review${reviewCount === 1 ? '' : 's'}`;
      document.getElementById('statClients').textContent = `${clientsServed} client${clientsServed === 1 ? '' : 's'}`;
      document.getElementById('statNetEarnings').textContent = formatCurrency(stats?.netEarnings ?? 0);
      document.getElementById('statPendingEarnings').textContent = formatCurrency(stats?.pendingEarnings ?? 0);
      document.getElementById('statConsultations').textContent = String(profile?.consultations?.length ?? 0);

      document.getElementById('walletAvailable').textContent = formatCurrency(wallet?.available ?? 0);
      document.getElementById('walletPending').textContent = formatCurrency(wallet?.pending ?? 0);

      renderWalletHistory(wallet?.history ?? []);
      renderReviews(reviews ?? []);

      document.getElementById('bankName').value = data.payoutAccount?.bankName ?? '';
      document.getElementById('accountNumber').value = data.payoutAccount?.accountNumber ?? '';
      document.getElementById('accountHolder').value = data.payoutAccount?.accountHolder ?? name;
      feather.replace();
    }

    function renderWalletHistory(entries){
      if (!entries.length){
        walletHistoryEl.innerHTML = '<p class="text-sm text-gray-500">Wallet history will appear here after your first consultation.</p>';
        return;
      }
      walletHistoryEl.innerHTML = entries.map(entry => `
        <div class="border border-gray-200/70 rounded-xl px-4 py-3 flex items-center justify-between text-sm">
          <div>
            <p class="font-medium text-gray-800">${entry.type}</p>
            <p class="text-xs text-gray-500">${new Date(entry.createdAt).toLocaleString()}</p>
          </div>
          <span class="${entry.amount >= 0 ? 'text-emerald-600' : 'text-red-500'} font-semibold">${formatCurrency(Math.abs(entry.amount ?? 0))}</span>
        </div>
      `).join('');
    }

    function renderReviews(reviews){
      if (!reviews.length){
        reviewList.innerHTML = '';
        noReviewsState.classList.remove('hidden');
        return;
      }
      noReviewsState.classList.add('hidden');
      reviewList.innerHTML = reviews.map(review => `
        <article class="border border-gray-200/70 rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-semibold text-gray-800">${review.client?.firstName ?? 'Client'} ${review.client?.lastName ?? ''}</p>
              <p class="text-xs text-gray-500">${new Date(review.createdAt).toLocaleDateString()}</p>
            </div>
            <span class="inline-flex items-center gap-1 text-primary font-semibold"><i data-feather="star" class="w-4 h-4"></i>${review.rating}</span>
          </div>
          <p class="text-sm text-gray-600 mt-3">${review.comment ?? 'No comment left.'}</p>
        </article>
      `).join('');
      feather.replace();
    }

    document.getElementById('requestPayoutBtn').addEventListener('click', () => {
      alert('Payout request submitted. Funds will arrive after verification.');
    });
    document.getElementById('viewWalletBtn').addEventListener('click', () => {
      walletHistoryEl.scrollIntoView({ behavior: 'smooth' });
    });
    document.getElementById('refreshReviewsBtn').addEventListener('click', loadProfessionalData);
    if (syncCalendarBtn) {
      syncCalendarBtn.addEventListener('click', () => alert('Calendar sync will connect to Google/Outlook in production.'));
    }

    payoutForm.addEventListener('submit', async event => {
      event.preventDefault();
      const formData = Object.fromEntries(new FormData(payoutForm).entries());
      try {
        const res = await fetch('/api/dashboard/professional/payout-account', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData),
        });
        if (!res.ok) {
          const body = await res.json().catch(() => ({ message: 'Unable to save payout account' }));
          throw new Error(body.message || 'Unable to save payout account');
        }
        payoutFormStatus.textContent = 'Payout account saved successfully.';
        payoutFormStatus.className = 'text-xs text-green-600 mt-3';
      } catch (error) {
        payoutFormStatus.textContent = error.message;
        payoutFormStatus.className = 'text-xs text-red-600 mt-3';
      }
    });

    function getFallbackProfessional(){
      return {
        profile: {
          user: { firstName: 'Chukwuemeka', lastName: 'Obi' },
          profession: 'Family Doctor',
          regulatoryBody: 'MDCN',
          profileImageUrl: '',
          licenseVerified: true,
          verifiedBadge: true,
          consultations: [
            { id: 'C-01', scheduledFor: new Date().toISOString(), status: 'PENDING', fee: 3000, client: { firstName: 'Amaka', lastName: 'U.' } },
            { id: 'C-02', scheduledFor: new Date(Date.now() + 3_600_000).toISOString(), status: 'CONFIRMED', fee: 3000, client: { firstName: 'Kelechi', lastName: 'D.' } },
          ],
          bankName: 'GTBank',
          accountNumber: '0123456789',
          accountHolder: 'Chukwuemeka Obi',
        },
        wallet: {
          available: 18550000,
          pending: 3750000,
          history: [
            { type: 'Consultation payout – Amaka U.', amount: 250000, createdAt: new Date().toISOString() },
            { type: 'Consultation payout – Emeka A.', amount: 250000, createdAt: new Date(Date.now() - 86_400_000).toISOString() },
            { type: 'Payout to GTBank • 1234', amount: -1500000, createdAt: new Date(Date.now() - 2 * 86_400_000).toISOString() },
          ],
        },
        stats: {
          clientsServed: 142,
          netEarnings: 37250000,
          pendingEarnings: 3750000,
          consultationsScheduled: 2,
          averageRating: 4.8,
          reviewCount: 48,
        },
        payoutAccount: {
          bankName: 'GTBank',
          accountNumber: '0123456789',
          accountHolder: 'Chukwuemeka Obi',
        },
        reviews: [
          { rating: 5, comment: 'Amazing consultation, quick diagnosis and follow-up plan.', createdAt: new Date().toISOString(), client: { firstName: 'Amaka', lastName: 'U.' } },
          { rating: 4, comment: 'Helpful and patient throughout the session.', createdAt: new Date(Date.now() - 172_800_000).toISOString(), client: { firstName: 'Kelechi', lastName: 'D.' } },
        ],
      };
    }

    loadProfessionalData();
  </script>
  <script src="assistant.js"></script>
</body>
</html>
